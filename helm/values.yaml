# Store/helm/values.yaml
# Darwin Store - Helm values
# Target Platform: OpenShift 4.x / Red Hat UBI 9

# -- Image configuration
# Retrying GitOps sync - Nudge 6
image:
  repository: ghcr.io/the-darwin-project/store
  tag: "23a5a22"
  pullPolicy: IfNotPresent
# -- Image pull secrets (if using private registry)
imagePullSecrets: []
# -- Replica count
replicaCount: 2
# -- Rollout trigger
restartedAt: "2026-02-23T12:12:00Z"
# -- Service configuration
service:
  store:
    type: ClusterIP
    port: 8080
  chaos:
    type: ClusterIP
    port: 9000
# -- Route configuration (OpenShift)
route:
  store:
    enabled: true
    # host: darwin-store.apps.example.com  # Leave empty for auto-generated
    annotations: {}
  chaos:
    enabled: true
    # host: darwin-chaos.apps.example.com  # Leave empty for auto-generated
    annotations: {}
  tls:
    enabled: true
    termination: edge # edge, passthrough, or reencrypt
    insecureEdgeTerminationPolicy: Redirect # Allow, Redirect, or None
# -- Application metadata
app:
  name: "darwin-store"
  version: "55.1"
# -- Postgres configuration
postgres:
  # Image settings (RHEL9 image for OpenShift CRI-O short-name enforcement)
  image:
    repository: registry.redhat.io/rhel9/postgresql-15
    digest: "sha256:07dec86e5af52b1819549de2185aef85f59ecf10719e03c536ea6bfdf4d4f1d1"
  # Replica count
  replicas: 1
  # Persistence settings
  # NOTE: Empty storageClass uses cluster default - verify with `oc get sc`
  # Set enabled: false for emptyDir (no data survives pod restart)
  persistence:
    enabled: true
    storageClass: ""
    size: 1Gi
    accessMode: ReadWriteMany
  # Authentication
  # Use existingSecret for production, password fallback for dev
  auth:
    existingSecret: ""
    password: "darwin"
  # Resource limits
  resources:
    requests:
      memory: 128Mi
      cpu: 500m
    limits:
      memory: 2Gi
      cpu: 1
# -- Store app resource limits
resources:
  requests:
    memory: 120Mi
    cpu: 50m
  limits:
    memory: 320Mi
    cpu: 300m
# -- Pod-level security context
# OpenShift assigns arbitrary UID from namespace range
# Do NOT set runAsUser - let OpenShift assign it
podSecurityContext:
  fsGroup: 1001
# -- Container-level security context
containerSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false # App needs /tmp for chaos state
  capabilities:
    drop:
      - ALL
# -- Node selector
nodeSelector: {}
# -- Tolerations
tolerations: []
# -- Affinity rules
affinity: {}
# -- Liveness and Readiness Probes
livenessProbe:
  initialDelaySeconds: 10
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3
readinessProbe:
  initialDelaySeconds: 5
  periodSeconds: 30
  timeoutSeconds: 3
  failureThreshold: 3
config:
  chaos_mode: "disabled"
  archAware:
    enabled: false
