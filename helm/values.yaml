# Store/helm/values.yaml
# Darwin Store - Helm values
# Target Platform: OpenShift 4.x / Red Hat UBI 9

# -- Image configuration
image:
  repository: ghcr.io/the-darwin-project/store
  tag: "6da2588" # Updated by CI to commit SHA
  pullPolicy: IfNotPresent
# -- Image pull secrets (if using private registry)
imagePullSecrets: []
# -- Replica count (scaled to 3)
replicaCount: 2
# -- Service configuration
service:
  store:
    type: ClusterIP
    port: 8080
  chaos:
    type: ClusterIP
    port: 9000
# -- Route configuration (OpenShift)
route:
  store:
    enabled: true
    # host: darwin-store.apps.example.com  # Leave empty for auto-generated
    annotations: {}
  chaos:
    enabled: true
    # host: darwin-chaos.apps.example.com  # Leave empty for auto-generated
    annotations: {}
  tls:
    enabled: true
    termination: edge # edge, passthrough, or reencrypt
    insecureEdgeTerminationPolicy: Redirect # Allow, Redirect, or None
# -- Darwin BlackBoard connection
# Service name follows pattern: {release-name}-brain (from BlackBoard Helm chart)
# ArgoCD app name "darwin-blackboard" becomes release name, so service is "darwin-blackboard-brain"
darwin:
  url: "http://darwin-blackboard-brain:8000"
  enabled: true
# -- Application metadata (sent in telemetry)
app:
  name: "darwin-store"
  version: "1.2.0"
# -- Postgres configuration
postgres:
  # Image settings
  image:
    repository: postgres
    tag: "15"
  # Replica count
  replicas: 1
  # Persistence settings
  # NOTE: Empty storageClass uses cluster default - verify with `oc get sc`
  # Set enabled: false for emptyDir (no data survives pod restart)
  persistence:
    enabled: true
    storageClass: ""
    size: 1Gi
    accessMode: ReadWriteMany
  # Authentication
  # Use existingSecret for production, password fallback for dev
  auth:
    existingSecret: ""
    password: "darwin"
  # Resource limits
  resources:
    requests:
      memory: 128Mi
      cpu: 500m
    limits:
      memory: 2Gi
      cpu: 1
# -- Store app resource limits
resources:
  requests:
    memory: 128Mi
    cpu: 100m
  limits:
    memory: 256Mi
    cpu: 500m
# -- Pod-level security context
# OpenShift assigns arbitrary UID from namespace range
# Do NOT set runAsUser - let OpenShift assign it
podSecurityContext:
  fsGroup: 1001
# -- Container-level security context
containerSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false # App needs /tmp for chaos state
  capabilities:
    drop:
      - ALL
# -- Node selector
nodeSelector: {}
# -- Tolerations
tolerations: []
# -- Affinity rules
affinity: {}
